export $(cat .env.production | xargs)
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker pull haroonkhalidclustox/w3-app:$TAG"
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker rm -f $IMAGE_NAME"
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker rm -f $SIDEKIQ_IMAGE_NAME"
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker run -d -p $PORT:3000 --network app-tier --name=$IMAGE_NAME -e RAILS_ENV=$RAILS_ENV -e DB_HOST=$DB_HOST -e DB_USERNAME=$DB_USERNAME -e DB_PASSWORD=$DB_PASSWORD -e DB_NAME=$DB_NAME -e SECRET_KEY_BASE=$SECRET_KEY_BASE -e RAILS_LOG_TO_STDOUT=$RAILS_LOG_TO_STDOUT -e RAILS_SERVE_STATIC_FILES=$RAILS_SERVE_STATIC_FILES -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -e AWS_BUCKET=$AWS_BUCKET -e AWS_REGION=$AWS_REGION -e SENDGRID_API_KEY=$SENDGRID_API_KEY -e SENDER_EMAIL=$SENDER_EMAIL -e HOST=$HOST -e PROFILE_PICTURE_PATH=$PROFILE_PICTURE_PATH -e IMAGE_PHOTO_PATH=$IMAGE_PHOTO_PATH -e ONESIGNAL_API_KEY=$ONESIGNAL_API_KEY -e ONESIGNAL_AUTH_KEY=$ONESIGNAL_AUTH_KEY -e ONESIGNAL_APP_ID=$ONESIGNAL_APP_ID -e REDIS_URL=$REDIS_URL haroonkhalidclustox/w3-app:$TAG /bin/sh -c \"bin/puma -C config/puma.rb\""
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker run -d --network app-tier --name=$SIDEKIQ_IMAGE_NAME -e RAILS_ENV=$RAILS_ENV -e DB_HOST=$DB_HOST -e DB_USERNAME=$DB_USERNAME -e DB_PASSWORD=$DB_PASSWORD -e DB_NAME=$DB_NAME -e SECRET_KEY_BASE=$SECRET_KEY_BASE -e RAILS_LOG_TO_STDOUT=$RAILS_LOG_TO_STDOUT -e RAILS_SERVE_STATIC_FILES=$RAILS_SERVE_STATIC_FILES -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -e AWS_BUCKET=$AWS_BUCKET -e AWS_REGION=$AWS_REGION -e SENDGRID_API_KEY=$SENDGRID_API_KEY -e SENDER_EMAIL=$SENDER_EMAIL -e HOST=$HOST -e PROFILE_PICTURE_PATH=$PROFILE_PICTURE_PATH -e IMAGE_PHOTO_PATH=$IMAGE_PHOTO_PATH -e ONESIGNAL_API_KEY=$ONESIGNAL_API_KEY -e ONESIGNAL_AUTH_KEY=$ONESIGNAL_AUTH_KEY -e ONESIGNAL_APP_ID=$ONESIGNAL_APP_ID -e REDIS_URL=$REDIS_URL haroonkhalidclustox/w3-app:$TAG /bin/sh -c \"bin/sidekiq -C config/sidekiq.yml\""
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker exec $IMAGE_NAME bundle exec whenever --update-crontab"
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker exec $IMAGE_NAME cron"
ssh -i /Users/haroonkhalid/Projects/3w-aws.pem ubuntu@35.183.208.7 "sudo docker image prune -a -f"